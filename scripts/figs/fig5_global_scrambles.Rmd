---
title: "R Notebook"
output: html_notebook
---

```{r setup, include=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
require(cowplot)
options(stringsAsFactors = F)
options(scipen = 10000)

data <-  read.table('../../processed_data/endo_scramble/endo_scramble_expression_formatted_std.txt', 
                             header = T)
ttest <- read.table('../../processed_data/endo_scramble/endo_scramble_ttests.txt', header = T)

data <- left_join(data, select(ttest, -tss_name), by = 'name')

```

Figure 5A
```{r}
repressor_color <- '#000066'
activator_color <- '#FFD700'

data <- data %>% 
    mutate(site_type_ttest_signif = ifelse(significant == T, site_type_ttest, NA)) %>% 
    mutate(site_type_signif = case_when(.$site_type_ttest_signif == 'increased' ~ 'activating',
                                 .$site_type_ttest_signif == 'reduced' ~ 'repressing'))

data %>% 
    filter(!is.na(site_type_signif)) %>% 
    ggplot(aes(unscrambled_exp, relative_exp)) + 
    geom_point(data = filter(data, is.na(site_type_signif)), 
               color = 'gray38', alpha = 0.25) +
    geom_point(alpha = 0.50, aes(color = site_type_signif)) +
    scale_color_manual(values = c(repressor_color, activator_color), na.value = 'gray65') +
    scale_x_log10(breaks = c(0.01, 0.1, 1, 10, 100, 1000)) + 
    scale_y_log10(breaks = c(0.01, 0.1, 1, 10, 100)) + annotation_logticks() +
    labs(x = 'wild-type expression',
         y = 'relative expression',
         color = 'significant\nFDR-adjusted\nt-test') +
    theme(aspect.ratio = 1,
          axis.text = element_text(size = 20),
          axis.title = element_text(size = 20),
          legend.text = element_text(size = 20),
          legend.title = element_text(size = 20))

ggsave('../../figs/fig5/fig5a_scramble_ttest.pdf', unit = 'in', 
       height = 5, width = 7)
```

Figure5D - Looking at disagreed scrambles

```{r}
scramble_merged <- read.table("../../processed_data/endo_scramble/scramble_merged_sites.txt", header = T)

scramble_merged %>% 
    # filter(!is.na(tf_concordance)) %>% 
    filter(tf_effect == '-' | tf_effect == '+' | is.na(tf_effect)) %>%
    group_by(tf_effect, tf_concordance) %>% 
    tally() %>% 
    ggplot(aes(tf_effect, n)) +
    geom_bar(stat = 'identity', position = 'dodge', aes(fill = tf_concordance)) +
    scale_y_continuous(breaks = seq(0, 1200, 100)) +
    # axis.break(axis = 1, breakpos = 500) +
    scale_fill_manual(values = c('#FFBC42', '#0496FF'), na.value = 'gray38') +
    labs(x = 'TFBS gene expression effect', y = 'count', 
         fill = 'concordance',
         title = 'merged scramble sites') +
    theme(legend.position = 'top', aspect.ratio = 1)

# ggsave('../../figs/fig5/fig5d_regulondb_concordance.pdf', units = 'in',
#        width = 8, height = 5)
```





